sumeru.config({httpServerPort:8080,sumeruPath:"/../sumeru"}),sumeru.router.add({pattern:"/itworks",action:"App.itworks"}),App.itworks=sumeru.controller.create(function(e,t){e.onrender=function(e){e("itworks",["push","left"])}}),sumeru.router.add({pattern:"/undercover",action:"App.undercover"}),sumeru.router.setDefault("App.undercover"),App.undercover=sumeru.controller.create(function(e,t){e.onrender=function(e){e("undercover",["push","left"])},e.onready=function(){document.getElementById("start_undercover").addEventListener("click",n)};var n=function(){e.redirect("/undercover_setting")}}),sumeru.router.add({pattern:"/undercover_setting",action:"App.undercover_setting"}),App.undercover_setting=sumeru.controller.create(function(e,t){e.onrender=function(e){e("undercover_setting",["push","left"])},e.onready=function(){$("#alter").hide(),document.getElementById("start_game").addEventListener("click",a),document.getElementById("addfather").addEventListener("click",n),document.getElementById("costfather").addEventListener("click",r),document.getElementById("addson").addEventListener("click",i),document.getElementById("costson").addEventListener("click",o)};var n=function(){$("#alter").hide();var e=parseInt($("#father_count").val());return $("#alter").hide(),e>=12?($("#alter").html("参与人数过多（4-12）"),$("#alter").show(),void 0):(e+=1,$("#father_count").val(e),void 0)},r=function(){$("#alter").hide();var e=parseInt($("#father_count").val());return $("#alter").hide(),4>=e?($("#alter").html("参与人数过少（4-12）"),$("#alter").show(),void 0):(e-=1,$("#father_count").val(e),void 0)},i=function(){$("#alter").hide();var e=parseInt($("#son_count").val());return e>=3?($("#alter").html("卧底人数过多（1-3）"),$("#alter").show(),void 0):(e+=1,$("#son_count").val(e),void 0)},o=function(){$("#alter").hide();var e=parseInt($("#son_count").val());return $("#alter").hide(),1>=e?($("#alter").html("卧底人数过少（1-3）"),$("#alter").show(),void 0):(e-=1,$("#son_count").val(e),void 0)},a=function(){var t=parseInt($("#father_count").val()),n=parseInt($("#son_count").val());e.redirect("/fanpai",{fathercount:t,soncount:n})}}),sumeru.router.add({pattern:"/fanpai",action:"App.fanpai"}),App.fanpai=sumeru.controller.create(function(e,t){e.onrender=function(e){e("fanpai",["push","left"])};var n=[],r=4,i=1,o=1,a=!0,s="";e.onready=function(){r=t.get("fathercount"),i=t.get("soncount"),n=c(r,i),console.log("restart"),document.getElementById("nextbtn").addEventListener("click",l),l()};var u=function(){n=c(r,i),console.log("restart"),o=1,a=!0,$("#wordtext").html("1"),$("#wordtext").show()},l=function(){o>r?($("#wordtext").hide(),e.redirect("/guess",{content:n,fathercount:r,soncount:i,sonword:s}),u()):$("#wordtext").show(),a?($("#wordtext").html(o),$("#nextbtn").html("点击查看词条"),console.log("showit"+o)):($("#wordtext").html(n[o-1]),$("#nextbtn").html("记住了，传给下一位"),console.log("showit"+n[o-1]),o++),a=!a},c=function(e,t){var n=["台灯_电灯","玫瑰_月季","若曦_晴川","孟非_乐嘉","牛奶_豆浆","保安_保镖","白菜_生菜","辣椒_芥末","金庸_古龙","赵敏_黄蓉","海豚_海狮"],r=n[parseInt(Math.random()*n.length)],i=r.split("_"),o=parseInt(Math.random()),a=Math.abs(o-1);s=i[a];for(var u=new Array(10),l=e-1;l>=0;l--)u[l]=i[o];for(var l=t-1;l>=0;l--){for(var c=parseInt(Math.random()*e);u[c]==i[a];)c=parseInt(Math.random()*e);u[c]=i[a]}for(var l=e-1;l>=0;l--)console.log(u[l]+l);return u}}),sumeru.router.add({pattern:"/guess",action:"App.guess"}),App.guess=sumeru.controller.create(function(e,t){e.onrender=function(e){e("guess",["push","left"])};var n=[],r=4,i=1,o="";e.onready=function(){n=t.get("content").split(","),u(),r=t.get("fathercount"),i=t.get("soncount"),o=t.get("sonword"),document.getElementById("restart").addEventListener("click",s),a()};var a=function(){t.undercoverword=e.subscribe("pub-undercover",function(e){t.bind("message-hall",{data:e.find()})})};e.onload=function(){return[a]};var s=function(){e.redirect("/fanpai",{fathercount:r,soncount:i})},u=function(){$("#guesscontent").html("");for(var e=1;e<=n.length;e++){0==(e-1)%4&&$("#guesscontent").append("<br/>");var t="<button id='under_"+e+"'  type='button'class='btn btn-default' style='width:20%;padding:5px;margin:5px;' onclick=''>"+e+"</button>";$("#guesscontent").append(t),document.getElementById("under_"+e).addEventListener("click",l)}},l=function(){var e=this.id.split("_")[1];$("#under_"+e).attr("disabled","disabled"),n[e-1]!=o?$("#under_"+e).html("冤死"+n[e-1]):$("#under_"+e).html("卧底"+n[e-1]),console.log(this.id),t.undercoverword.destroy({sessionid:"wanbin"}),t.undercoverword.add({fathercount:10,content:"wanibn"+e,sonword:"w",sessionid:"wanbin"}),t.undercoverword.save()}}),Model.undercoverword=function(e){e.config={fields:[{name:"fathercount",type:"int"},{name:"content",type:"text"},{name:"sonword",type:"text"},{name:"sessionid",type:"text"}]}},Model.message=function(e){e.config={fields:[{name:"content",type:"text"},{name:"time",type:"datetime",defaultValue:"now()"}]}};